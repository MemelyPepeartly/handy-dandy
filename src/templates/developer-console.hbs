<form class="developer-console__form">
  <section class="developer-console__settings">
    <label>
      <input type="checkbox" name="dumpInvalidJson" {{#if settings.dumpInvalidJson}}checked{{/if}}>
      Dump last invalid JSON
    </label>
    <label>
      <input type="checkbox" name="dumpAjvErrors" {{#if settings.dumpAjvErrors}}checked{{/if}}>
      Dump Ajv errors
    </label>
    <button type="button" data-action="clear-logs">
      <i class="fas fa-trash"></i>
      Clear Logs
    </button>
  </section>

  <section class="developer-console__section">
    <h3>AI Interactions</h3>
    {{#if gptLogs.length}}
      <table class="developer-console__table">
        <thead>
          <tr>
            <th>Time</th>
            <th>Schema</th>
            <th>Method</th>
            <th>Duration</th>
            <th>Tokens</th>
            <th>Status</th>
            <th>Error</th>
          </tr>
        </thead>
        <tbody>
          {{#each gptLogs}}
            <tr>
              <td>{{timestamp}}</td>
              <td>{{schemaName}}<br><small>{{promptHash}}</small></td>
              <td>{{method}}</td>
              <td>{{duration}}</td>
              <td>{{#if tokens}}{{tokens}}{{else}}—{{/if}}</td>
              <td>{{status}}</td>
              <td>{{#if error}}<code>{{error}}</code>{{else}}—{{/if}}</td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    {{else}}
      <p class="developer-console__empty">No AI interactions recorded.</p>
    {{/if}}
  </section>

  <section class="developer-console__section">
    <h3>Validation Failures</h3>
    {{#if validationLogs.length}}
      <div class="developer-console__validation-list">
        {{#each validationLogs}}
          <article class="developer-console__validation-entry">
            <header>
              <strong>{{type}}</strong>
              <span>{{timestamp}}</span>
              <span>{{attempts}} attempt{{#unless (eq attempts 1)}}s{{/unless}}</span>
            </header>
            {{#if invalidJson}}
              <details>
                <summary>Invalid JSON</summary>
                <pre>{{invalidJson}}</pre>
              </details>
            {{/if}}
            {{#if errors}}
              <details>
                <summary>Ajv Errors</summary>
                <ul>
                  {{#each errors}}
                    <li>{{this}}</li>
                  {{/each}}
                </ul>
              </details>
            {{/if}}
          </article>
        {{/each}}
      </div>
    {{else}}
      <p class="developer-console__empty">No validation diagnostics recorded.</p>
    {{/if}}
  </section>
</form>
